<link rel="import" href="../../bower_components/polymer/polymer.html">

<!--
`polymer-quickpick`
Rough polymer implementation of the QuickPick control

@demo demo/index.html
-->

<dom-module id="polymer-quickpick">
    <link rel="import" href="../common-control/control-title.html">
    <link rel="import" href="quick-pick-list.html">
    <template>
        <control-title control-title="[[quickPickTitle]]" is-error=[[quickPickError]] is-required="[[isRequired]]"></control-title>
        <selectable-button on-click="openList" button-value="[[quickPickValue]]"></selectable-button>
        <quick-pick-list multi="[[multi]]" is-open="[[isOpen]]" list-items="[[quickPickItems]]"></quick-pick-list>
    </template>

    <script>

    var DEFAULT_QUICKPICK_VALUE = {
        title: 'Select',
        value: false
    };

    var MULTI_QUICKPICK_VALUE = {
        title: 'Select',
        value: {}
    };

    Polymer({

        is: 'polymer-quickpick',

        properties: {
            quickPickTitle: {
                type: String
            },
            quickPickItems: {
                type: Array
            },
            quickPickError: {
                type: Boolean,
                value: false,
                notify: true
            },
            quickPickValue:{
                type: String,
                value: DEFAULT_QUICKPICK_VALUE
            },
            isRequired: {
                type: Boolean,
                value: false
            },
            isOpen: {
                type: Boolean,
                value: false
            },
            multi: {
                type: Boolean,
                value: false
            }
        },

        listeners: {
            'selection-made': 'setValue'
        },

        setValue: function(event){
            var value;
            var selected = event.detail;

            if(selected.constructor === Array){
                value = MULTI_QUICKPICK_VALUE;
                value.value = selected;
            }
            else{
                this.quickPickValue = selected.value ? selected : DEFAULT_QUICKPICK_VALUE;
            }

            this.isOpen = false;

            if(!this.quickPickValue.value === false){
                this.validate();
            }
        },

        openList: function(){
            this.isOpen = !this.isOpen;
        },

        validate: function(){
            this.quickPickError = (this.quickPickValue.value === false);
        }

    });
    </script>
</dom-module>
